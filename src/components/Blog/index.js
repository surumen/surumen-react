import React, { Component } from 'react';

import menu_icon from '../../img/icon-menu.svg';
import about_icon from '../../img/icon-about.svg';
import github_icon from '../../img/icon-github.svg';
import dribble_icon from '../../img/icon-dribbble.svg';
import arrow_icon from '../../img/icon-arrow.svg';

import faces from '../../img/faces.png';
import '../../stylesheets/style.css';

class App extends Component {

  render() {
    return (
      <div>
        <div className="header menu-active bg-white
    h3 vh-100-l
    br-l b--light-gray
    fixed-l top-0 left-0 z-max
    flex justify-between flex-row-reverse flex-row-l items-center items-start-l">
          <div className="ph4 pv0-l w-100 w-auto-l flex flex-column-l justify-between items-center">
            <div className="vh-50-l flex items-end">
              <a href="/" className="no-underline">
                <h1 className="f4 f3-l ma0">Moses</h1>
              </a>
            </div>
            <div className="fixed-l bottom-0 left-0 inline-flex justify-center items-center ma4-l">
              <a href="/about" className="o-50 glow">
                <img src={about_icon} alt="About" />
              </a>
            </div>
          </div>
          <div className="menu open">
            <a href="/" className="vh-100 vh-50-l flex items-center items-end-l justify-center">
              <img src={menu_icon} alt="" className="mb1" />
            </a>
          </div>
        </div>
        <div id="barba-wrapper">
          <div className="barba-container menu-active" data-namespace="post">
            <div className="ph4 ph5-l">
              <header className="min-vh-50-l lh-solid w-100 mt2 mb5 pt4
      flex flex-column items-baseline justify-between">
                <span className="f7 ttu tracked-mega mono silver mb5">
                  Machine Learning
                </span>
                <h1 className="f2 f1-m f-5-l mt2 mb0 mw7 lh-title lh-solid-l">
                  Facial Recognition using SVMs
                </h1>
              </header>
              <div className="
      nested-copy-seperator
      nested-copy-line-height
      nested-headline-line-height
      nested-margin-first">
                <p className="f7 ttu tracked-mega mono silver mb2 pb3">
                  Linear Algebra, Optimization, Probability
                </p>
                <div className="measure">
                  <p>Facial recognition is often done on Facebook, Google Photos, among many other applications. To allow a Facebook user to tag their friends easily, Facebook often suggests the "tags" which actually tend to be very accurate. One way to do this is to use <a href="https://en.wikipedia.org/wiki/Eigenface">eigenfaces</a>. </p>
                  <h4>What are Eigenfaces?</h4>
                  <p>Eigenfaces is an appearance-based approach to facial recognition that works by capturing the variation in a collection of faces(images) and use that information to compare and encode images of individual faces in a "feature-based" manner.</p>
                  <h4>What are Support Vector Machines?</h4>
                  <p>A support vector machine is a supervised machine learning model used in both classification and regression. In classification, SVMs find a hyperplane that maximizes the margin between two classes. If the data is linearly separable based on the classes, it's straightforward. However, in cases where the data is not linearly separable, we introduce "slack variables" to account for mis-classification.</p>
                  <h2 id="the-process">Loading your Dataset</h2>
                  <p>We will be using faces from the <a href="http://vis-www.cs.umass.edu/lfw/lfw-funneled.tgz">Labeled Faces in the Wild</a> dataset. The dataset contains over 12,000 faces. Our task will be to learn the 5 most represented people in the dataset. We will be using Python3.4 and the stable version of the Scikit library</p>
                  <p>
                  </p><pre><code>{"\n"}<span className="hljs-comment">#Import Python libraries</span>{"\n"}<span className="k">print</span> <span className="n">__doc__</span>{"\n"}<span className="kn">import</span> <span className="nn">os</span>{"\n"}<span className="kn">from</span> <span className="nn">gzip</span> <span className="kn">import</span> <span className="n">GzipFile</span>{"\n"}<span className="kn">import</span> <span className="nn">numpy</span> <span className="kn">as</span> <span className="nn">np</span>{"\n"}<span className="kn">import</span> <span className="nn">pylab</span> <span className="kn">as</span> <span className="nn">pl</span>{"\n"}{"\n"}<span className="kn">from</span> <span className="nn">scikits.learn.grid_search</span> <span className="kn">import</span> <span className="n">GridSearchCV</span>{"\n"}<span className="kn">from</span> <span className="nn">scikits.learn.metrics</span> <span className="kn">import</span> <span className="n">classification_report</span>{"\n"}<span className="kn">from</span> <span className="nn">scikits.learn.metrics</span> <span className="kn">import</span> <span className="n">confusion_matrix</span>{"\n"}<span className="kn">from</span> <span className="nn">scikits.learn.pca</span> <span className="kn">import</span> <span className="n">RandomizedPCA</span>{"\n"}<span className="kn">from</span> <span className="nn">scikits.learn.svm</span> <span className="kn">import</span> <span className="n">SVC</span>{"\n"}<span className="c"># Download the data, if not already on disk</span>{"\n"}{"\n"}<span className="n">url</span> <span className="o">=</span> <span className="s">"https://downloads.sourceforge.net/project/scikit-learn/data/lfw_preprocessed.tar.gz"</span>{"\n"}<span className="n">archive_name</span> <span className="o">=</span> <span className="s">"lfw_preprocessed.tar.gz"</span>{"\n"}<span className="n">folder_name</span> <span className="o">=</span> <span className="s">"lfw_preprocessed"</span>{"\n"}{"\n"}<span className="k">if</span> <span className="ow">not</span> <span className="n">os</span><span className="o">.</span><span className="n">path</span><span className="o">.</span><span className="n">exists</span><span className="p">(</span><span className="n">folder_name</span><span className="p">):</span>{"\n"}<span className="k">if</span> <span className="ow">not</span> <span className="n">os</span><span className="o">.</span><span className="n">path</span><span className="o">.</span><span className="n">exists</span><span className="p">(</span><span className="n">archive_name</span><span className="p">):</span>{"\n"}<span className="kn">import</span> <span className="nn">urllib</span>{"\n"}<span className="k">print</span> <span className="s">"Downloading data, please Wait (58.8MB)..."</span>{"\n"}<span className="k">print</span> <span className="n">url</span>{"\n"}<span className="n">opener</span> <span className="o">=</span> <span className="n">urllib</span><span className="o">.</span><span className="n">urlopen</span><span className="p">(</span><span className="n">url</span><span className="p">)</span>{"\n"}<span className="nb">open</span><span className="p">(</span><span className="n">archive_name</span><span className="p">,</span> <span className="s">'wb'</span><span className="p">)</span><span className="o">.</span><span className="n">write</span><span className="p">(</span><span className="n">opener</span><span className="o">.</span><span className="n">read</span><span className="p">())</span>{"\n"}<span className="k">print</span>{"\n"}{"\n"}<span className="kn">import</span> <span className="nn">tarfile</span>{"\n"}<span className="k">print</span> <span className="s">"Decompressiong the archive: "</span> <span className="o">+</span> <span className="n">archive_name</span>{"\n"}<span className="n">tarfile</span><span className="o">.</span><span className="n">open</span><span className="p">(</span><span className="n">archive_name</span><span className="p">,</span> <span className="s">"r:gz"</span><span className="p">)</span><span className="o">.</span><span className="n">extractall</span><span className="p">()</span>{"\n"}<span className="k">print</span>{"\n"}{"\n"}<span className="c">################################################################################</span>{"\n"}<span className="c"># Load dataset in memory</span>{"\n"}{"\n"}<span className="n">faces_filename</span> <span className="o">=</span> <span className="n">os</span><span className="o">.</span><span className="n">path</span><span className="o">.</span><span className="n">join</span><span className="p">(</span><span className="n">folder_name</span><span className="p">,</span> <span className="s">"faces.npy.gz"</span><span className="p">)</span>{"\n"}<span className="n">filenames_filename</span> <span className="o">=</span> <span className="n">os</span><span className="o">.</span><span className="n">path</span><span className="o">.</span><span className="n">join</span><span className="p">(</span><span className="n">folder_name</span><span className="p">,</span> <span className="s">"face_filenames.txt"</span><span className="p">)</span>{"\n"}</code>{"\n"}</pre>
                  <p />
                  <h2 id="getting-prepared">Convert images into column vectors</h2>
                  <p>Our next step is to put the image pixels in an array and put the array in a column of a matrix. For example, if we had only 2 faces, we will have 2 columns in the matrix. If each face has N gray-scale pixels, we will have N rows in the matrix. We will create this matrix X from all the images in our dataset.</p>
                  <p className="MathJax_Display" style={{textAlign: 'center'}}><span className="MathJax" id="MathJax-Element-9-Frame" tabIndex={0} data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mrow><mo>[</mo><mtable rowspacing=&quot;4pt&quot; columnspacing=&quot;1em&quot;><mtr><mtd><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>11</mn></mrow></msub></mtd><mtd><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>12</mn></mrow></msub></mtd></mtr><mtr><mtd><mo>⋮</mo></mtd><mtd><mo>⋮</mo></mtd></mtr><mtr><mtd><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mn>1</mn></mrow></msub></mtd><mtd><msub><mi>x</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi><mn>2</mn></mrow></msub></mtd></mtr></mtable><mo>]</mo></mrow></math>" role="presentation" style={{textAlign: 'center', position: 'relative', fontSize: '113%'}}><nobr aria-hidden="true"><span className="math" id="MathJax-Span-31" style={{width: '8.727em', display: 'inline-block'}}><span style={{display: 'inline-block', position: 'relative', width: '7.146em', height: 0, fontSize: '122%'}}><span style={{position: 'absolute', clip: 'rect(2.169em, 1007.09em, 6.619em, -999.997em)', top: '-4.622em', left: '0em'}}><span className="mrow" id="MathJax-Span-32"><span className="mi" id="MathJax-Span-33" style={{fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>X<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.061em'}} /></span><span className="mo" id="MathJax-Span-34" style={{fontFamily: 'STIXGeneral', paddingLeft: '0.296em'}}>=</span><span className="mrow" id="MathJax-Span-35" style={{paddingLeft: '0.296em'}}><span className="mo" id="MathJax-Span-36" style={{verticalAlign: '2.286em'}}><span style={{display: 'inline-block', position: 'relative', width: '0.471em', height: 0}}><span style={{position: 'absolute', fontFamily: 'STIXSizeOneSym', top: '-3.276em', left: '0em'}}>⎡<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', fontFamily: 'STIXSizeOneSym', top: '-0.173em', left: '0em'}}>⎣<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{fontFamily: 'STIXSizeOneSym', position: 'absolute', top: '-2.515em', left: '0em'}}>⎢<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{fontFamily: 'STIXSizeOneSym', position: 'absolute', top: '-1.754em', left: '0em'}}>⎢<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{fontFamily: 'STIXSizeOneSym', position: 'absolute', top: '-0.992em', left: '0em'}}>⎢<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span></span><span className="mtable" id="MathJax-Span-37" style={{paddingRight: '0.179em', paddingLeft: '0.179em'}}><span style={{display: 'inline-block', position: 'relative', width: '3.926em', height: 0}}><span style={{position: 'absolute', clip: 'rect(2.579em, 1001.41em, 6.619em, -999.997em)', top: '-4.681em', left: '0em'}}><span style={{display: 'inline-block', position: 'relative', width: '1.408em', height: 0}}><span style={{position: 'absolute', clip: 'rect(3.34em, 1001.23em, 4.335em, -999.997em)', top: '-5.501em', left: '50%', marginLeft: '-0.583em'}}><span className="mtd" id="MathJax-Span-38"><span className="mrow" id="MathJax-Span-39"><span className="msubsup" id="MathJax-Span-40"><span style={{display: 'inline-block', position: 'relative', width: '1.232em', height: 0}}><span style={{position: 'absolute', clip: 'rect(3.34em, 1000.47em, 4.16em, -999.997em)', top: '-3.978em', left: '0em'}}><span className="mi" id="MathJax-Span-41" style={{fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>x<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.003em'}} /></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', top: '-3.803em', left: '0.471em'}}><span className="texatom" id="MathJax-Span-42"><span className="mrow" id="MathJax-Span-43"><span className="mn" id="MathJax-Span-44" style={{fontSize: '70.7%', fontFamily: 'STIXGeneral'}}>11</span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span></span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', clip: 'rect(2.813em, 1000.3em, 4.277em, -999.997em)', top: '-3.803em', left: '50%', marginLeft: '-0.231em'}}><span className="mtd" id="MathJax-Span-52"><span className="mrow" id="MathJax-Span-53"><span className="mo" id="MathJax-Span-54" style={{fontFamily: 'STIXGeneral'}}>⋮</span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', clip: 'rect(3.34em, 1001.41em, 4.335em, -999.997em)', top: '-2.398em', left: '50%', marginLeft: '-0.7em'}}><span className="mtd" id="MathJax-Span-58"><span className="mrow" id="MathJax-Span-59"><span className="msubsup" id="MathJax-Span-60"><span style={{display: 'inline-block', position: 'relative', width: '1.408em', height: 0}}><span style={{position: 'absolute', clip: 'rect(3.34em, 1000.47em, 4.16em, -999.997em)', top: '-3.978em', left: '0em'}}><span className="mi" id="MathJax-Span-61" style={{fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>x<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.003em'}} /></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', top: '-3.803em', left: '0.471em'}}><span className="texatom" id="MathJax-Span-62"><span className="mrow" id="MathJax-Span-63"><span className="mi" id="MathJax-Span-64" style={{fontSize: '70.7%', fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>N<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.061em'}} /></span><span className="mn" id="MathJax-Span-65" style={{fontSize: '70.7%', fontFamily: 'STIXGeneral'}}>1</span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span></span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span><span style={{display: 'inline-block', width: 0, height: '4.687em'}} /></span><span style={{position: 'absolute', clip: 'rect(2.579em, 1001.41em, 6.619em, -999.997em)', top: '-4.681em', left: '2.52em'}}><span style={{display: 'inline-block', position: 'relative', width: '1.408em', height: 0}}><span style={{position: 'absolute', clip: 'rect(3.34em, 1001.23em, 4.335em, -999.997em)', top: '-5.501em', left: '50%', marginLeft: '-0.583em'}}><span className="mtd" id="MathJax-Span-45"><span className="mrow" id="MathJax-Span-46"><span className="msubsup" id="MathJax-Span-47"><span style={{display: 'inline-block', position: 'relative', width: '1.232em', height: 0}}><span style={{position: 'absolute', clip: 'rect(3.34em, 1000.47em, 4.16em, -999.997em)', top: '-3.978em', left: '0em'}}><span className="mi" id="MathJax-Span-48" style={{fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>x<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.003em'}} /></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', top: '-3.803em', left: '0.471em'}}><span className="texatom" id="MathJax-Span-49"><span className="mrow" id="MathJax-Span-50"><span className="mn" id="MathJax-Span-51" style={{fontSize: '70.7%', fontFamily: 'STIXGeneral'}}>12</span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span></span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', clip: 'rect(2.813em, 1000.3em, 4.277em, -999.997em)', top: '-3.803em', left: '50%', marginLeft: '-0.231em'}}><span className="mtd" id="MathJax-Span-55"><span className="mrow" id="MathJax-Span-56"><span className="mo" id="MathJax-Span-57" style={{fontFamily: 'STIXGeneral'}}>⋮</span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', clip: 'rect(3.34em, 1001.41em, 4.335em, -999.997em)', top: '-2.398em', left: '50%', marginLeft: '-0.7em'}}><span className="mtd" id="MathJax-Span-66"><span className="mrow" id="MathJax-Span-67"><span className="msubsup" id="MathJax-Span-68"><span style={{display: 'inline-block', position: 'relative', width: '1.408em', height: 0}}><span style={{position: 'absolute', clip: 'rect(3.34em, 1000.47em, 4.16em, -999.997em)', top: '-3.978em', left: '0em'}}><span className="mi" id="MathJax-Span-69" style={{fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>x<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.003em'}} /></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', top: '-3.803em', left: '0.471em'}}><span className="texatom" id="MathJax-Span-70"><span className="mrow" id="MathJax-Span-71"><span className="mi" id="MathJax-Span-72" style={{fontSize: '70.7%', fontFamily: 'STIXGeneral', fontStyle: 'italic'}}>N<span style={{display: 'inline-block', overflow: 'hidden', height: 1, width: '0.061em'}} /></span><span className="mn" id="MathJax-Span-73" style={{fontSize: '70.7%', fontFamily: 'STIXGeneral'}}>2</span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span></span></span></span><span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span><span style={{display: 'inline-block', width: 0, height: '4.687em'}} /></span></span></span><span className="mo" id="MathJax-Span-74" style={{verticalAlign: '2.286em'}}><span style={{display: 'inline-block', position: 'relative', width: '0.471em', height: 0}}><span style={{position: 'absolute', fontFamily: 'STIXSizeOneSym', top: '-3.276em', left: '0em'}}>⎤<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{position: 'absolute', fontFamily: 'STIXSizeOneSym', top: '-0.173em', left: '0em'}}>⎦<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{fontFamily: 'STIXSizeOneSym', position: 'absolute', top: '-2.515em', left: '0em'}}>⎥<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{fontFamily: 'STIXSizeOneSym', position: 'absolute', top: '-1.754em', left: '0em'}}>⎥<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span><span style={{fontFamily: 'STIXSizeOneSym', position: 'absolute', top: '-0.992em', left: '0em'}}>⎥<span style={{display: 'inline-block', width: 0, height: '3.984em'}} /></span></span></span></span></span><span style={{display: 'inline-block', width: 0, height: '4.628em'}} /></span></span><span style={{display: 'inline-block', overflow: 'hidden', verticalAlign: '-2.282em', borderLeft: '0px solid', width: 0, height: '5.146em'}} /></span></nobr></span></p>
                  <p>Our matrix X is definitely very large, and computation would take long. This is where eigenfaces comes in handy. We would do dimensionality reduction on the matrix X. Dimensionality reduction refers to the process of converting a set of data with vast dimensions into lesser dimensions while ensuring that the resulting data conveys similar information concisely. This will help us reduce the storage space required, and fastens the time required for performing computations. This also takes care of multi-collinearity in the columns of the matrix X (removing redundant feautures).</p>
                  <h2 id="getting-prepared">Calculating the mean and normalizing</h2>
                  <p>We would need to normalize our data inorder to maximize the variance. Normalization projects our original data onto directions which maximize the variance (called principal components). This is why eigenfaces is also referred to as principal component analysis (PCA). When data is represented as a matrix, normalization would mean transforming each vector in the matrix so that it has unit norm. When data is just random variables, normalization would mean tranforming the data to a normal distribution.</p>
                  <pre><code>{"\n"}<span className="n">faces</span> <span className="o">=</span> <span className="n">np</span><span className="o">.</span><span className="n">load</span><span className="p">(</span><span className="n">GzipFile</span><span className="p">(</span><span className="n">faces_filename</span><span className="p">))</span>{"\n"}<span className="n">face_filenames</span> <span className="o">=</span> <span className="p">[</span><span className="n">l</span><span className="o">.</span><span className="n">strip</span><span className="p">()</span> <span className="k">for</span> <span className="n">l</span> <span className="ow">in</span> <span className="nb">file</span><span className="p">(</span><span className="n">filenames_filename</span><span className="p">)</span><span className="o">.</span><span className="n">readlines</span><span className="p">()]</span>{"\n"}{"\n"}<span className="c"># normalize each picture by centering brightness</span>{"\n"}<span className="n">faces</span> <span className="o">-=</span> <span className="n">faces</span><span className="o">.</span><span className="n">mean</span><span className="p">(</span><span className="n">axis</span><span className="o">=</span><span className="mi">1</span><span className="p">)[:,</span> <span className="n">np</span><span className="o">.</span><span className="n">newaxis</span><span className="p">]</span>{"\n"}</code>{"\n"}</pre>
                  <h2 id="getting-prepared">Creating a Lookup Table</h2>
                  <p>A lookup table is just an array that replaces runtime computation with a simpler array indexing operation. Retrieving a value from memory is faster than doing computation each time we need to use the value.</p>
                  <pre><code>{"\n"}<span className="c"># Index category names into integers suitable for scikit-learn</span>{"\n"}<span className="n">categories</span> <span className="o">=</span> <span className="n">np</span><span className="o">.</span><span className="n">array</span><span className="p">([</span><span className="n">f</span><span className="o">.</span><span className="n">rsplit</span><span className="p">(</span><span className="s">'_'</span><span className="p">,</span> <span className="mi">1</span><span className="p">)[</span><span className="mi">0</span><span className="p">]</span> <span className="k">for</span> <span className="n">f</span> <span className="ow">in</span> <span className="n">face_filenames</span><span className="p">])</span>{"\n"}{"\n"}<span className="c"># A unique integer per category</span>{"\n"}<span className="n">category_names</span> <span className="o">=</span> <span className="n">np</span><span className="o">.</span><span className="n">unique</span><span className="p">(</span><span className="n">categories</span><span className="p">)</span>{"\n"}{"\n"}<span className="c"># Turn the categories in their corresponding integer label</span>{"\n"}<span className="n">target</span> <span className="o">=</span> <span className="n">np</span><span className="o">.</span><span className="n">searchsorted</span><span className="p">(</span><span className="n">category_names</span><span className="p">,</span> <span className="n">categories</span><span className="p">)</span>{"\n"}{"\n"}<span className="c"># Subsample the dataset to restrict to the most frequent categories</span>{"\n"}<span className="n">selected_target</span> <span className="o">=</span> <span className="n">np</span><span className="o">.</span><span className="n">argsort</span><span className="p">(</span><span className="n">np</span><span className="o">.</span><span className="n">bincount</span><span className="p">(</span><span className="n">target</span><span className="p">))[</span><span className="o">-</span><span className="mi">5</span><span className="p">:]</span>{"\n"}{"\n"}<span className="c"># If you are using a numpy version &gt;= 1.4, this can be done with 'np.in1d'</span>{"\n"}<span className="n">mask</span> <span className="o">=</span> <span className="n">np</span><span className="o">.</span><span className="n">array</span><span className="p">([</span><span className="n">item</span> <span className="ow">in</span> <span className="n">selected_target</span> <span className="k">for</span> <span className="n">item</span> <span className="ow">in</span> <span className="n">target</span><span className="p">])</span>{"\n"}{"\n"}<span className="n">X</span> <span className="o">=</span> <span className="n">faces</span><span className="p">[</span><span className="n">mask</span><span className="p">]</span>{"\n"}<span className="n">y</span> <span className="o">=</span> <span className="n">target</span><span className="p">[</span><span className="n">mask</span><span className="p">]</span>{"\n"}{"\n"}<span className="n">n_samples</span><span className="p">,</span> <span className="n">n_features</span> <span className="o">=</span> <span className="n">X</span><span className="o">.</span><span className="n">shape</span>{"\n"}{"\n"}<span className="k">print</span> <span className="s">"Dataset size:"</span>{"\n"}<span className="k">print</span> <span className="s">"n_samples: </span><span className="si">%d</span><span className="s">"</span> <span className="o">%</span> <span className="n">n_samples</span>{"\n"}<span className="k">print</span> <span className="s">"n_features: </span><span className="si">%d</span><span className="s">"</span> <span className="o">%</span> <span className="n">n_features</span>{"\n"}<span className="n">split</span> <span className="o">=</span> <span className="n">n_samples</span> <span className="o">*</span> <span className="mi">3</span> <span className="o">/</span> <span className="mi">4</span>{"\n"}{"\n"}<span className="n">X_train</span><span className="p">,</span> <span className="n">X_test</span> <span className="o">=</span> <span className="n">X</span><span className="p">[:</span><span className="n">split</span><span className="p">],</span> <span className="n">X</span><span className="p">[</span><span className="n">split</span><span className="p">:]</span>{"\n"}<span className="n">y_train</span><span className="p">,</span> <span className="n">y_test</span> <span className="o">=</span> <span className="n">y</span><span className="p">[:</span><span className="n">split</span><span className="p">],</span> <span className="n">y</span><span className="p">[</span><span className="n">split</span><span className="p">:]</span>{"\n"}</code>{"\n"}</pre>
                  <h2 id="understanding-our-client">Compute the principal components</h2>
                  <p>We are now ready to do a principal component analysis (PCA) on our face dataset (treated as unlabelled). This process is also referred to as feature extraction or just dimensionaly reduction as we mentioned earlier.</p>
                  <pre><code>{"\n"}<span className="n">n_components</span> <span className="o">=</span> <span className="mi">150</span>{"\n"}{"\n"}<span className="k">print</span> <span className="s">"Extracting the top </span><span className="si">%d</span><span className="s"> eigenfaces"</span> <span className="o">%</span> <span className="n">n_components</span>{"\n"}<span className="n">pca</span> <span className="o">=</span> <span className="n">RandomizedPCA</span><span className="p">(</span><span className="n">n_components</span><span className="o">=</span><span className="n">n_components</span><span className="p">,</span> <span className="n">whiten</span><span className="o">=</span><span className="bp">True</span><span className="p">)</span><span className="o">.</span><span className="n">fit</span><span className="p">(</span><span className="n">X_train</span><span className="p">)</span>{"\n"}{"\n"}<span className="n">eigenfaces</span> <span className="o">=</span> <span className="n">pca</span><span className="o">.</span><span className="n">components_</span><span className="o">.</span><span className="n">T</span><span className="o">.</span><span className="n">reshape</span><span className="p">((</span><span className="n">n_components</span><span className="p">,</span> <span className="mi">64</span><span className="p">,</span> <span className="mi">64</span><span className="p">))</span>{"\n"}{"\n"}<span className="c"># project the input data on the eigenfaces orthonormal basis</span>{"\n"}<span className="n">X_train_pca</span> <span className="o">=</span> <span className="n">pca</span><span className="o">.</span><span className="n">transform</span><span className="p">(</span><span className="n">X_train</span><span className="p">)</span>{"\n"}<span className="n">X_test_pca</span> <span className="o">=</span> <span className="n">pca</span><span className="o">.</span><span className="n">transform</span><span className="p">(</span><span className="n">X_test</span><span className="p">)</span>{"\n"}</code>{"\n"}</pre>
                  <h2 id="interviewing-the-audience">Train a Support Vector Machine model</h2>
                  <p>As we mentioned in the introduction, a support vector machine works by finding a hyperplane that maximizes the margin between different classes in our dataset. In this case, our data is not linearly separable so we would need to introduce 'slack variables'. Our model will then find the hyperplane that maximizes the margin and minimizes misclassifications. Our algorithm will try to maintain the slack variable at zero while maximizing the margin. However, it does not minimize the number of misclassifications, but rather the sum of distances from the margin (NP-complete problem).</p>
                  <p>A nonlinear region would separate the classes in our dataset more effectively. Our model handles this by using a non-linear kernel function to map the data into a different space where a linear hyperplane cannot be used to do the separation. (The kernel function transforms the data into a higher dimensional feature space to make it possible to perform linear separation). There are many kernel function. We will use a radial basis kernel function (rbf) to train our model.</p>
                  <pre><code>{"\n"}<span className="k">print</span> <span className="s">"Fitting the classifier to the training set"</span>{"\n"}<span className="n">param_grid</span> <span className="o">=</span> <span className="p">{"{"}</span>{"\n"} <span className="s">'C'</span><span className="p">:</span> <span className="p">[</span><span className="mi">1</span><span className="p">,</span> <span className="mi">5</span><span className="p">,</span> <span className="mi">10</span><span className="p">,</span> <span className="mi">50</span><span className="p">,</span> <span className="mi">100</span><span className="p">],</span>{"\n"} <span className="s">'gamma'</span><span className="p">:</span> <span className="p">[</span><span className="mf">0.0001</span><span className="p">,</span> <span className="mf">0.0005</span><span className="p">,</span> <span className="mf">0.001</span><span className="p">,</span> <span className="mf">0.005</span><span className="p">,</span> <span className="mf">0.01</span><span className="p">,</span> <span className="mf">0.1</span><span className="p">],</span>{"\n"}<span className="p">{"}"}</span>{"\n"}<span className="n">clf</span> <span className="o">=</span> <span className="n">GridSearchCV</span><span className="p">(</span><span className="n">SVC</span><span className="p">(</span><span className="n">kernel</span><span className="o">=</span><span className="s">'rbf'</span><span className="p">),</span> <span className="n">param_grid</span><span className="p">,</span>{"\n"}{"                   "}<span className="n">fit_params</span><span className="o">=</span><span className="p">{"{"}</span><span className="s">'class_weight'</span><span className="p">:</span> <span className="s">'auto'</span><span className="p">{"}"})</span>{"\n"}<span className="n">clf</span> <span className="o">=</span> <span className="n">clf</span><span className="o">.</span><span className="n">fit</span><span className="p">(</span><span className="n">X_train_pca</span><span className="p">,</span> <span className="n">y_train</span><span className="p">)</span>{"\n"}<span className="k">print</span> <span className="s">"Best estimator found by grid search:"</span>{"\n"}<span className="k">print</span> <span className="n">clf</span><span className="o">.</span><span className="n">best_estimator</span>{"\n"}</code>{"\n"}</pre>
                  <h2 id="summing-it-up">Evaluating our model</h2>
                  <p>We will now do a quantitative evaluation of our model quality on the test set.</p>
                  <pre><code>{"\n"}<span className="n">y_pred</span> <span className="o">=</span> <span className="n">clf</span><span className="o">.</span><span className="n">predict</span><span className="p">(</span><span className="n">X_test_pca</span><span className="p">)</span>{"\n"}<span className="k">print</span> <span className="n">classification_report</span><span className="p">(</span><span className="n">y_test</span><span className="p">,</span> <span className="n">y_pred</span><span className="p">,</span> <span className="n">labels</span><span className="o">=</span><span className="n">selected_target</span><span className="p">,</span>{"\n"}{"                            "}<span className="n">class_names</span><span className="o">=</span><span className="n">category_names</span><span className="p">[</span><span className="n">selected_target</span><span className="p">])</span>{"\n"}{"\n"}<span className="k">print</span> <span className="n">confusion_matrix</span><span className="p">(</span><span className="n">y_test</span><span className="p">,</span> <span className="n">y_pred</span><span className="p">,</span> <span className="n">labels</span><span className="o">=</span><span className="n">selected_target</span><span className="p">)</span>{"\n"}</code>{"\n"}</pre>
                  <h2 id="practicing-our-art">Summming it up</h2>
                  <p>Finally we can now do a qualitative evaluation of the predictions from our model. We will plot the top 5 most represented people in our dataset.</p>
                  <pre><code>{"\n"}<span className="n">n_row</span> <span className="o">=</span> <span className="mi">3</span>{"\n"}<span className="n">n_col</span> <span className="o">=</span> <span className="mi">4</span>{"\n"}{"\n"}<span className="n">pl</span><span className="o">.</span><span className="n">figure</span><span className="p">(</span><span className="n">figsize</span><span className="o">=</span><span className="p">(</span><span className="mi">2</span> <span className="o">*</span> <span className="n">n_col</span><span className="p">,</span> <span className="mf">2.3</span> <span className="o">*</span> <span className="n">n_row</span><span className="p">))</span>{"\n"}<span className="n">pl</span><span className="o">.</span><span className="n">subplots_adjust</span><span className="p">(</span><span className="n">bottom</span><span className="o">=</span><span className="mi">0</span><span className="p">,</span> <span className="n">left</span><span className="o">=.</span><span className="mo">01</span><span className="p">,</span> <span className="n">right</span><span className="o">=.</span><span className="mi">99</span><span className="p">,</span> <span className="n">top</span><span className="o">=.</span><span className="mi">95</span><span className="p">,</span> <span className="n">hspace</span><span className="o">=.</span><span className="mi">15</span><span className="p">)</span>{"\n"}<span className="k">for</span> <span className="n">i</span> <span className="ow">in</span> <span className="nb">range</span><span className="p">(</span><span className="n">n_row</span> <span className="o">*</span> <span className="n">n_col</span><span className="p">):</span>{"\n"}{"    "}<span className="n">pl</span><span className="o">.</span><span className="n">subplot</span><span className="p">(</span><span className="n">n_row</span><span className="p">,</span> <span className="n">n_col</span><span className="p">,</span> <span className="n">i</span> <span className="o">+</span> <span className="mi">1</span><span className="p">)</span>{"\n"}{"    "}<span className="n">pl</span><span className="o">.</span><span className="n">imshow</span><span className="p">(</span><span className="n">X_test</span><span className="p">[</span><span className="n">i</span><span className="p">]</span><span className="o">.</span><span className="n">reshape</span><span className="p">((</span><span className="mi">64</span><span className="p">,</span> <span className="mi">64</span><span className="p">)),</span> <span className="n">cmap</span><span className="o">=</span><span className="n">pl</span><span className="o">.</span><span className="n">cm</span><span className="o">.</span><span className="n">gray</span><span className="p">)</span>{"\n"}{"    "}<span className="n">pl</span><span className="o">.</span><span className="n">title</span><span className="p">(</span><span className="s">'pred: </span><span className="si">%s</span><span className="se">\n</span><span className="s">true: </span><span className="si">%s</span><span className="s">'</span> <span className="o">%</span> <span className="p">(</span><span className="n">category_names</span><span className="p">[</span><span className="n">y_pred</span><span className="p">[</span><span className="n">i</span><span className="p">]],</span>{"\n"}{"                                     "}<span className="n">category_names</span><span className="p">[</span><span className="n">y_test</span><span className="p">[</span><span className="n">i</span><span className="p">]]),</span> <span className="n">size</span><span className="o">=</span><span className="mi">12</span><span className="p">)</span>{"\n"}{"    "}<span className="n">pl</span><span className="o">.</span><span className="n">xticks</span><span className="p">(())</span>{"\n"}{"    "}<span className="n">pl</span><span className="o">.</span><span className="n">yticks</span><span className="p">(())</span>{"\n"}{"\n"}<span className="n">pl</span><span className="o">.</span><span className="n">show</span><span className="p">()</span>{"\n"}</code>{"\n"}</pre>
                  <p>The expected results are shown below.
                    <img src={faces} alt=""/>
                  </p>
                </div>
              </div>
            </div>
            <div className="bt bb b--light-gray flex content-stretch justify-end mt6">
              <a className="hover-bg-near-white no-underline 
        flex items-center w-50 pv3 pv4-ns ph4 ph5-l" href>
                <img src={arrow_icon} alt="Maze" />
                <span className="pl3 dn db-l">
                  Amazing Maze
                </span>
              </a>
              <a className="hover-bg-near-white no-underline 
        flex items-center justify-end w-50 tr pv3 pv4-ns ph4 ph5-l bl b--light-gray" href>
                <span className="pr3 dn db-l">
                  Google Chrome extension
                </span>
                <img className="rotate-180" src={arrow_icon} alt="Extension" />
              </a>
            </div>
            <div className="mh4 mh5-l pv3 pv4-l gray f7 flex-ns justify-between items-center">
              <div className="mv3 mv0-ns inline-flex items-center">
                <a href="https://github.com/surumen" className="o-50 glow no-underline mr3">
                  <img src={github_icon} alt="GitHub" />
                </a>
                <a href="https://www.linkedin.com/in/mosessurumen/" className="o-50 glow no-underline mr3">
                  <img src={dribble_icon} alt="Linkedin" />
                </a>
              </div>
              <div className>
                © 2017 Moses Surumen
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }
}

export default App;